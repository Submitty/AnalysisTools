#!/usr/bin/env python3

"""
Given a directory containing concatenated source files, run pygmentize
on each file, generating a corresponding HTML file for each.
"""

import argparse
import os
import shutil
import subprocess

ARGPARSER = argparse.ArgumentParser(\
        description="Iterate over a directory of student submissions.")
ARGPARSER.add_argument("directory")
ARGS = ARGPARSER.parse_args()

CONCATENATED = os.listdir(ARGS.directory)

try:
    shutil.rmtree(os.path.join("plagiarism_data", "highlighted"))
except FileNotFoundError:
    pass

try:
    os.mkdir("plagiarism_data")
except FileExistsError:
    pass

try:
    os.mkdir(os.path.join("plagiarism_data", "highlighted"))
except FileExistsError:
    pass

for c in CONCATENATED:
    infile = os.path.join(ARGS.directory, c)
    outfile = os.path.join("plagiarism_data", "highlighted", c) + ".html"
    HIGHLIGHT = subprocess.Popen(["pygmentize", "-l", "cpp", "-f", "html",
                                  "-O", "full", "-o", outfile, infile])
    HIGHLIGHT.wait()
